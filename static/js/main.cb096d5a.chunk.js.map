{"version":3,"sources":["reducers/lines.js","reducers/cursor.js","reducers/index.js","actions/index.js","components/Line.js","utils/render.js","components/Lines.js","components/App.js","index.js"],"names":["lines","newState","state","arguments","length","undefined","text","action","type","console","log","no","preview","map","item","index","slice","splice","cursor","col","row","dirty","combineReducers","changeLine","insertLine","setCursor","Line","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","send","bind","assertThisInitialized","keyHandler","clickHandler","e","onChange","target","value","keyCode","onUp","selectionStart","onDown","selectionEnd","onLeftUp","onEnter","preventDefault","onBS","onClick","react_default","a","createElement","className","style","display","isFocus","ref","onKeyDown","dangerouslySetInnerHTML","__html","refs","rawInput","focus","that","setTimeout","setSelectionRange","column","onRefreshed","updateFocus","React","Component","Text","propTypes","PropTypes","func","isRequired","number","isRequires","string","Render","indexOf","Lines","line","components_Line","assign","key","onBSfunc","addFocus","addClassName","calcClassName","LinesContainer","connect","ownProps","dispatch","pos","t1","t2","pretext","t","deleteLine","App","components_Lines","store","createStore","rootReducer","subscribe","getState","ReactDOM","render","es","components_App","document","getElementById"],"mappings":"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","file":"static/js/main.cb096d5a.chunk.js","sourcesContent":["function lines(state = [{text:\"\"}], action){\r\n  let newState;\r\n  switch(action.type){\r\n    case 'PREVIEW_LINE':\r\n      console.log(\"PREVIEW_LINE\", action.no, action.preview)\r\n      return state.map((item, index) => {\r\n        if(index !== action.no){\r\n          return item\r\n        }\r\n        return {\r\n          text: item.text,\r\n          preview: action.preview\r\n        }\r\n      })\r\n    case 'CHANGE_LINE':\r\n      console.log(\"CHANGE_LINE\", action.no, action.text)\r\n      return state.map((item, index) => {\r\n        if(index !== action.no){\r\n          return item\r\n        }\r\n        return {\r\n          text: action.text,\r\n          preview: action.preview\r\n        }\r\n      })\r\n    case 'INSERT_LINE':\r\n      console.log(\"INSERT_LINE\", action.no, action.text)\r\n      newState = state.slice()\r\n      newState.splice(action.no, 0, {\r\n        text: action.text,\r\n        preview: action.preview\r\n      })\r\n      return newState\r\n    case 'DELETE_LINE':\r\n      console.log(\"DELETE_LINE\", action.no)\r\n      newState = state.slice()\r\n      newState.splice(action.no, 1)\r\n      return newState\r\n\r\n  }\r\n  return state\r\n}\r\n\r\nexport default lines\r\n","function cursor(state = {col: 0, row: 0, dirty: false}, action){\r\n  switch(action.type){\r\n    case 'SET_CURSOR':\r\n      return {\r\n        row: action.row,\r\n        col: action.col,\r\n        dirty: action.dirty,\r\n      }\r\n  }\r\n  return state;\r\n}\r\n\r\nexport default cursor\r\n","import { combineReducers } from 'redux'\r\nimport lines from './lines'\r\nimport cursor from './cursor'\r\n\r\nexport default combineReducers({\r\n  lines,\r\n  cursor,\r\n})\r\n\r\n\r\n","\r\nexport const previewLine = (no, html) => ({\r\n  type: 'PREVIEW_LINE',\r\n  html,\r\n  no,\r\n})\r\n\r\nexport const changeLine = (no, text, preview) => ({\r\n  type: 'CHANGE_LINE',\r\n  text,\r\n  preview,\r\n  no,\r\n})\r\n\r\nexport const deleteLine = (no, text) => ({\r\n  type: 'DELETE_LINE',\r\n  text,\r\n  no,\r\n})\r\n\r\nexport const insertLine = (no, text, preview) => ({\r\n  type: 'INSERT_LINE',\r\n  text,\r\n  preview,\r\n  no,\r\n})\r\n\r\nexport const setCursor = (row, col, dirty) => ({\r\n  type: 'SET_CURSOR',\r\n  row,\r\n  col,\r\n  dirty,\r\n})\r\n\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types'\r\n\r\nclass Line extends React.Component{\r\n  constructor(props) {\r\n    super(props)\r\n    this.send = this.send.bind(this);\r\n    this.keyHandler = this.keyHandler.bind(this);\r\n    this.clickHandler = this.clickHandler.bind(this);\r\n  }\r\n  send(e){\r\n    this.props.onChange(this.props.no, e.target.value)\r\n    return;\r\n  }\r\n  keyHandler(e){\r\n    switch(e.keyCode){\r\n      case 38: //up\r\n      this.props.onUp(this.props.no, e.target.selectionStart)\r\n      break;\r\n      case 40: //down\r\n      this.props.onDown(this.props.no, e.target.selectionStart)\r\n      break;\r\n      case 37: //left\r\n      // when cursor is head\r\n      if(e.target.selectionStart == 0 && e.target.selectionEnd == 0){\r\n        this.props.onLeftUp(this.props.no)\r\n      }else{\r\n      }\r\n      break;\r\n      case 39: //right\r\n      // when cursor is end\r\n      if(e.target.selectionStart == this.props.text.length){\r\n        this.props.onDown(this.props.no, 0)\r\n      }else{\r\n      }\r\n      break;\r\n      case 13: //enter\r\n      this.props.onEnter(this.props.no, this.props.text, e.target.selectionStart)\r\n      e.preventDefault()\r\n      break;\r\n      case 8: //BS\r\n      // when cursor is head\r\n      if(e.target.selectionStart == 0 && e.target.selectionEnd == 0){\r\n        this.props.onBS(this.props.no, this.props.text)\r\n        e.preventDefault()\r\n      }\r\n      break;\r\n\r\n    }\r\n  }\r\n  clickHandler(e){\r\n    this.props.onClick(this.props.no);\r\n  }\r\n  render() {\r\n    return (\r\n      <div className={'line ' + this.props.className} onClick={this.clickHandler}>\r\n        <div style={{display: this.props.isFocus?\"block\":\"none\"}}>\r\n          <textarea ref=\"rawInput\" onChange={this.send} onKeyDown={this.keyHandler} value={this.props.text} />\r\n        </div>\r\n        <div style={{display: !this.props.isFocus?\"block\":\"none\"}}>\r\n          <div dangerouslySetInnerHTML={{__html:this.props.preview}} />\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n  updateFocus(){\r\n    if(this.props.isFocus){\r\n      this.refs.rawInput.focus();\r\n      if(this.props.dirty){\r\n        var that = this;\r\n        setTimeout(function(){\r\n          console.log(\"update cursor\");\r\n          // FIXME: remove setTimeout\r\n          that.refs.rawInput.setSelectionRange(that.props.column, that.props.column);\r\n          that.props.onRefreshed(that.props.no);\r\n          // ---\r\n        },10);\r\n      }\r\n      console.log(this.refs.rawInput)\r\n    }\r\n  }\r\n  componentDidUpdate(){\r\n    this.updateFocus()\r\n  }\r\n  componentDidMount(){\r\n    this.updateFocus()\r\n  }\r\n\r\n}\r\nText.propTypes = {\r\n  onChange: PropTypes.func.isRequired,\r\n  onUp: PropTypes.func.isRequired,\r\n  onDown: PropTypes.func.isRequired,\r\n  onClick: PropTypes.func.isRequired,\r\n  onLeftUp: PropTypes.func.isRequired,\r\n  onBS: PropTypes.func.isRequired,\r\n  onRefreshed: PropTypes.func.isRequired,\r\n  no: PropTypes.number.isRequires,\r\n  text: PropTypes.string.isRequired\r\n}\r\n\r\nexport default Line\r\n","function Render(text){\n  console.log(\"Render\", text)\n  if(text.indexOf(\"###\") == 0){\n    return \"<div>\" + text + \"<div>\"\n  }else if(text.indexOf(\"##\") == 0){\n    return \"<div>\" + text + \"<div>\"\n  }else if(text.indexOf(\"#\") == 0){\n    return \"<div>\" + text + \"<div>\"\n  }\n  return \"<div>\"+text+\"</div>\"\n}\n\nexport default Render\n","import React from 'react';\r\nimport { connect } from 'react-redux'\r\nimport PropTypes from 'prop-types'\r\nimport {changeLine, insertLine, deleteLine, setCursor} from '../actions'\r\nimport Line from './Line'\r\nimport Render from '../utils/render'\r\n\r\nclass Lines extends React.Component{\r\n  constructor(props) {\r\n    super(props)\r\n  }\r\n  render() {\r\n    return (\r\n      <div>\r\n        {this.props.lines.map((line, index) => (\r\n          <Line\r\n                key={index}\r\n                {...line}\r\n                onChange={this.props.onChange}\r\n                onUp={this.props.onUp}\r\n                onDown={this.props.onDown}\r\n                onEnter={this.props.onEnter}\r\n                onClick={this.props.onClick}\r\n                onLeftUp={this.props.onLeftUp(\r\n                        index==0?\"\":this.props.lines[index - 1])}\r\n                onBS={this.props.onBSfunc(\r\n                        index==0?\"\":this.props.lines[index - 1])}\r\n                onRefreshed={this.props.onRefreshed}\r\n                />\r\n        ))}\r\n      </div>\r\n    )\r\n  }\r\n}\r\nLines.propTypes = {\r\n  onChange: PropTypes.func.isRequired,\r\n  onUp: PropTypes.func.isRequired,\r\n  onDown: PropTypes.func.isRequired,\r\n  onEnter: PropTypes.func.isRequired,\r\n  onClick: PropTypes.func.isRequired,\r\n  onBSfunc: PropTypes.func.isRequired,\r\n}\r\n\r\nconst addNumber = (lines => {\r\n  return lines.map((line, index) => {\r\n    line.no = index\r\n    return line;\r\n  })\r\n})\r\nconst addFocus = ((col, row, dirty, lines) => {\r\n  return lines.map((line, index) => {\r\n    if(index == row){\r\n      line.isFocus = true;\r\n      line.column = col;\r\n      line.dirty = dirty;\r\n    }else{\r\n      line.isFocus = false;\r\n    }\r\n    return line;\r\n  });\r\n})\r\nconst calcClassName = (text) => {\r\n  let className = \"normal\"\r\n  if(text.indexOf(\"###\") == 0){\r\n    className = \"h3\"\r\n  }else if(text.indexOf(\"##\") == 0){\r\n    className = \"h2\"\r\n  }else if(text.indexOf(\"#\") == 0){\r\n    className = \"h1\"\r\n  }\r\n  return className;\r\n}\r\nconst addClassName = (lines => {\r\n  return lines.map(line => {\r\n    line.className = calcClassName(line.text);\r\n    if(line.isFocus){\r\n      line.className += \" focus\"\r\n    }\r\n    return line;\r\n  })\r\n})\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n  return {\r\n    lines: addClassName(addFocus(state.cursor.col, state.cursor.row, state.cursor.dirty, addNumber(state.lines))),\r\n    cursor: state.cursor\r\n  }\r\n}\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n    onChange: (no,text) => {\r\n      dispatch(changeLine(no, text, Render(text)))\r\n    },\r\n    onUp: (no, col) => {\r\n      if(no > 0){\r\n        dispatch(setCursor(no - 1, col, true))\r\n      }\r\n    },\r\n    onDown: (no, col) => {\r\n      dispatch(setCursor(no + 1, col, true))\r\n    },\r\n    onEnter: (no, text, pos) => {\r\n      dispatch(setCursor(no + 1, 0, true))\r\n      if(text == undefined)text = \"\"\r\n      let t1 = text.slice(0, pos)\r\n      dispatch(changeLine(no, t1, Render(t1)))\r\n      let t2 = text.slice(pos)\r\n      dispatch(insertLine(no + 1, t2, Render(t2)))\r\n    },\r\n    onLeftUp: (pretext) => (no) =>{\r\n      if(no > 0){\r\n        dispatch(setCursor(no - 1, pretext.text.length, true))\r\n      }\r\n    },\r\n    onBSfunc: (pretext) => (no, text) =>{\r\n      dispatch(setCursor(no - 1, pretext.text.length, true))\r\n      let t = pretext.text + text;\r\n      dispatch(changeLine(no-1, t, Render(t)))\r\n      dispatch(deleteLine(no))\r\n    },\r\n    onClick: (no) => {\r\n      dispatch(setCursor(no, 0, true))\r\n    },\r\n    onRefreshed: (no) => {\r\n      dispatch(setCursor(no, 0, false))\r\n    }\r\n  }\r\n}\r\n\r\nconst LinesContainer = connect(mapStateToProps, mapDispatchToProps)(Lines)\r\n\r\nexport default LinesContainer\r\n","import React from 'react'\r\nimport Lines from './Lines'\r\n\r\nconst App = () => (\r\n  <div>\r\n    <Lines />\r\n  </div>\r\n)\r\n\r\nexport default App\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { createStore } from 'redux'\r\nimport { Provider } from 'react-redux'\r\nimport rootReducer from './reducers'\r\nimport App from './components/App'\r\nimport {insertLine, changeLine} from './actions'\r\nimport './index.css';\r\nimport Render from './utils/render'\r\n\r\nconst store = createStore(rootReducer)\r\nconst unsubscribe = store.subscribe(() => console.log(\"state\",store.getState()))\r\n\r\nstore.dispatch(insertLine(0,\r\n  \"# React.jsで作ったインラインマークダウンエディタ\",\r\n  Render(\"# React.jsで作ったインラインマークダウンエディタ\")\r\n))\r\nstore.dispatch(insertLine(1,\r\n  \"カーソル移動などまだおかしいです。\",\r\n  Render(\"カーソル移動などまだおかしいです。\")\r\n))\r\nstore.dispatch(insertLine(2,\r\n  \"## 作った人\",\r\n  Render(\"## 作った人\")\r\n))\r\nstore.dispatch(insertLine(3,\r\n  \"@ina_ani\",\r\n  Render(\"@ina_ani\")\r\n))\r\n\r\nReactDOM.render(\r\n  <Provider store={store}>\r\n    <App />\r\n  </Provider>,\r\n  document.getElementById('root')\r\n)\r\n"],"sourceRoot":""}